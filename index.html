<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width,initial-scale=1,viewport-fit=cover"
        />
        <title>Split Expenses</title>

        <style>
            :root {
                --bg: #fafafa;
                --card: #ffffff;
                --border: #e6e6e6;
                --text: #111;
                --muted: #666;
                --shadow: 0 10px 30px rgba(0, 0, 0, 0.07);
                --radius: 18px;
            }

            * {
                box-sizing: border-box;
            }

            body {
                margin: 0;
                background: var(--bg);
                color: var(--text);
                font-family:
                    system-ui,
                    -apple-system,
                    Segoe UI,
                    Roboto,
                    Arial,
                    sans-serif;
            }

            .wrap {
                max-width: 980px;
                margin: 0 auto;
                padding: 16px;
                padding-bottom: calc(16px + env(safe-area-inset-bottom));
            }

            header {
                display: flex;
                align-items: baseline;
                justify-content: space-between;
                gap: 12px;
                margin: 6px 0 14px;
            }

            h1 {
                margin: 0;
                font-size: 22px;
                letter-spacing: -0.2px;
            }

            .subtle {
                font-size: 13px;
                color: var(--muted);
                margin: 0;
            }

            .grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 16px;
                align-items: start;
            }

            .card {
                background: var(--card);
                border: 1px solid var(--border);
                border-radius: var(--radius);
                padding: 14px;
                box-shadow: var(--shadow);
            }

            h2 {
                margin: 0 0 10px;
                font-size: 18px;
            }

            h3 {
                margin: 10px 0 6px;
                font-size: 16px;
            }

            label {
                display: block;
                font-size: 13px;
                margin: 10px 0 6px;
                color: #222;
            }

            input,
            select,
            button {
                font-size: 16px;
                /* prevents iOS zoom-on-focus */
                padding: 12px;
            }

            input,
            select {
                width: 100%;
                border: 1px solid #d6d6d6;
                border-radius: 12px;
                background: #fff;
                outline: none;
            }

            input:focus,
            select:focus {
                border-color: #bdbdbd;
            }

            .row {
                display: flex;
                gap: 10px;
                align-items: end;
                flex-wrap: wrap;
            }

            .row > * {
                flex: 1;
                min-width: 180px;
            }

            .row .small {
                flex: 0.75;
                min-width: 140px;
            }

            .actions {
                display: flex;
                gap: 10px;
                margin-top: 12px;
            }

            button {
                border: 1px solid #d6d6d6;
                border-radius: 12px;
                background: #f4f4f4;
                cursor: pointer;
                min-height: 44px;
                width: 100%;
            }

            button:hover {
                background: #ededed;
            }

            button:active {
                transform: translateY(1px);
            }

            .muted {
                color: var(--muted);
                font-size: 13px;
            }

            .result {
                font-weight: 750;
                font-size: 16px;
                line-height: 1.25;
                margin: 0 0 6px;
            }

            hr {
                border: none;
                border-top: 1px solid var(--border);
                margin: 12px 0;
            }

            .twoCols {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 14px;
            }

            .totalline {
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: 10px;
                margin-bottom: 6px;
            }

            .pill {
                display: inline-flex;
                align-items: center;
                gap: 8px;
                padding: 8px 10px;
                border: 1px solid var(--border);
                border-radius: 999px;
                font-size: 13px;
                color: #222;
                background: #fcfcfc;
                white-space: nowrap;
            }

            .tableWrap {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                border-radius: 12px;
            }

            table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 6px;
                min-width: 340px;
            }

            td {
                padding: 10px 6px;
                border-bottom: 1px solid #f0f0f0;
                vertical-align: middle;
            }

            td.right {
                text-align: right;
                white-space: nowrap;
            }

            .nameCell {
                max-width: 220px;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }

            .removeBtn {
                width: auto;
                padding: 10px 12px;
            }

            /* Mobile: single column + sticky action bar */
            @media (max-width: 820px) {
                .grid {
                    grid-template-columns: 1fr;
                }

                .twoCols {
                    grid-template-columns: 1fr;
                }

                .wrap {
                    padding-bottom: calc(92px + env(safe-area-inset-bottom));
                }

                .actions {
                    display: none;
                }

                .stickyBar {
                    position: fixed;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    padding: 12px 16px calc(12px + env(safe-area-inset-bottom));
                    background: rgba(250, 250, 250, 0.92);
                    backdrop-filter: blur(10px);
                    border-top: 1px solid var(--border);
                    z-index: 50;
                }

                .stickyInner {
                    max-width: 980px;
                    margin: 0 auto;
                    display: flex;
                    gap: 10px;
                }

                .stickyInner button {
                    width: 100%;
                }
            }

            /* Desktop: hide sticky bar */
            @media (min-width: 821px) {
                .stickyBar {
                    display: none;
                }
            }
        </style>
    </head>

    <body>
        <div class="wrap">
            <header>
                <div>
                    <h1>Split Expenses (Py &amp; Lukas)</h1>
                    <p class="subtle">
                        Saved locally in your browser (refresh-safe).
                    </p>
                </div>
                <span class="pill" id="savedIndicator">Saved</span>
            </header>

            <div class="grid">
                <div class="card">
                    <h2>Add expense</h2>

                    <div class="row">
                        <div class="small">
                            <label for="person">Person</label>
                            <select id="person">
                                <option value="py">Py</option>
                                <option value="lukas">Lukas</option>
                            </select>
                        </div>

                        <div>
                            <label for="name">Expense name</label>
                            <input
                                id="name"
                                placeholder="e.g. hyra, netflix, viaplay"
                                autocomplete="off"
                            />
                        </div>

                        <div class="small">
                            <label for="amount">Amount (kr)</label>
                            <input
                                id="amount"
                                type="number"
                                min="0"
                                inputmode="numeric"
                                placeholder="0"
                            />
                        </div>
                    </div>

                    <div class="actions">
                        <button id="addBtn" type="button">Add</button>
                        <button id="resetBtn" type="button">Reset</button>
                    </div>

                    <p class="muted" style="margin: 10px 2px 0">
                        Tip: Press <b>Enter</b> in the amount field to add.
                    </p>
                </div>

                <div class="card">
                    <h2>Result</h2>
                    <p id="summary" class="result"></p>
                    <p id="note" class="muted" style="margin: 0"></p>

                    <hr />

                    <div class="twoCols">
                        <div>
                            <div class="totalline">
                                <h3 style="margin: 0">Py</h3>
                                <span class="pill"
                                    >Total:
                                    <b><span id="pyTotal">0</span></b> kr</span
                                >
                            </div>
                            <div id="pyTable"></div>
                        </div>

                        <div>
                            <div class="totalline">
                                <h3 style="margin: 0">Lukas</h3>
                                <span class="pill"
                                    >Total:
                                    <b><span id="lukasTotal">0</span></b>
                                    kr</span
                                >
                            </div>
                            <div id="lukasTable"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sticky action bar for phones -->
        <div class="stickyBar">
            <div class="stickyInner">
                <button id="addBtnSticky" type="button">Add</button>
                <button id="resetBtnSticky" type="button">Reset</button>
            </div>
        </div>

        <script>
            const STORAGE_KEY = "split-expenses-state-v1";
            const state = { py: [], lukas: [] };

            function loadState() {
                try {
                    const raw = localStorage.getItem(STORAGE_KEY);
                    if (!raw) return;
                    const parsed = JSON.parse(raw);
                    state.py = Array.isArray(parsed.py) ? parsed.py : [];
                    state.lukas = Array.isArray(parsed.lukas)
                        ? parsed.lukas
                        : [];
                } catch {
                    // ignore corrupt data
                }
            }

            function flashSaved() {
                const el = document.getElementById("savedIndicator");
                el.textContent = "Saved";
                el.style.opacity = "1";
                el.style.transform = "scale(1)";
                clearTimeout(flashSaved._t);
                flashSaved._t = setTimeout(() => {
                    el.style.opacity = "0.85";
                }, 700);
            }

            function saveState() {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
                flashSaved();
            }

            function totalFor(who) {
                return state[who].reduce(
                    (s, e) => s + (Number(e.amount) || 0),
                    0,
                );
            }

            function escapeHtml(str) {
                return String(str)
                    .replaceAll("&", "&amp;")
                    .replaceAll("<", "&lt;")
                    .replaceAll(">", "&gt;")
                    .replaceAll('"', "&quot;")
                    .replaceAll("'", "&#39;");
            }

            function renderTable(who) {
                if (!state[who].length)
                    return "<p class='muted'>No expenses</p>";

                return `
        <div class="tableWrap">
          <table>
            <tbody>
              ${state[who]
                  .map(
                      (e, i) => `
                <tr>
                  <td class="nameCell">${escapeHtml(e.name)}</td>
                  <td class="right">${Number(e.amount).toFixed(0)} kr</td>
                  <td class="right">
                    <button class="removeBtn" type="button" onclick="removeExpense('${who}', ${i})">Remove</button>
                  </td>
                </tr>
              `,
                  )
                  .join("")}
            </tbody>
          </table>
        </div>
      `;
            }

            function calculate() {
                const pyTotal = totalFor("py");
                const lukasTotal = totalFor("lukas");

                document.getElementById("pyTotal").textContent =
                    pyTotal.toFixed(0);
                document.getElementById("lukasTotal").textContent =
                    lukasTotal.toFixed(0);

                const diff = pyTotal - lukasTotal;

                let summary = "";
                if (diff > 0) {
                    summary = `Lukas must pay ${(diff / 2).toFixed(0)} kr to Py.`;
                } else if (diff < 0) {
                    summary = `Py must pay ${(-diff / 2).toFixed(0)} kr to Lukas.`;
                } else {
                    summary = "Py and Lukas have the same expenses.";
                }

                document.getElementById("summary").textContent = summary;

                // Keep your original note logic
                document.getElementById("note").textContent =
                    `Lukas transfers ${(lukasTotal + 390).toFixed(0)} kr to the Hyra account.`;

                document.getElementById("pyTable").innerHTML =
                    renderTable("py");
                document.getElementById("lukasTable").innerHTML =
                    renderTable("lukas");

                saveState();
            }

            function addExpense() {
                const who = document.getElementById("person").value;
                const name = document.getElementById("name").value.trim();
                const amount = Number(document.getElementById("amount").value);

                if (!name || !(amount > 0)) return;

                state[who].push({ name, amount });
                document.getElementById("name").value = "";
                document.getElementById("amount").value = "";
                document.getElementById("name").focus();
                calculate();
            }

            // Must be global because it's called from inline onclick=""
            window.removeExpense = function (who, i) {
                state[who].splice(i, 1);
                calculate();
            };

            function resetAll() {
                state.py = [];
                state.lukas = [];
                calculate();
            }

            // Wire buttons
            document.getElementById("addBtn").onclick = addExpense;
            document.getElementById("resetBtn").onclick = resetAll;
            document.getElementById("addBtnSticky").onclick = addExpense;
            document.getElementById("resetBtnSticky").onclick = resetAll;

            // Enter to add when typing amount
            document
                .getElementById("amount")
                .addEventListener("keydown", (e) => {
                    if (e.key === "Enter") addExpense();
                });

            loadState();
            calculate();
        </script>
    </body>
</html>
